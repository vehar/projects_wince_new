; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\COMMON\SRC\SOC\OMAP2420_MS_V1\SDHC\BASE\sdhcmain.cpp
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	EXPORT	|DllEntry|
	IMPORT	|SDHCDDeinitializeHCLib|
	IMPORT	|SDDeinitializeCardLib|
	IMPORT	|SDHCDInitializeHCLib|
	IMPORT	|SDInitializeCardLib|
	IMPORT	|DisableThreadLibraryCalls|
; File c:\wince600\platform\common\src\soc\omap2420_ms_v1\sdhc\base\sdhcmain.cpp

  00000			 AREA	 |.pdata|, PDATA
|$T40609| DCD	|$LN12@DllEntry|
	DCD	0x40001601
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |DllEntry| PROC

; 55   : {

  00000		 |$LN12@DllEntry|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M40606|

; 56   :     if ( Reason == DLL_PROCESS_ATTACH ) {

  00004	e3510001	 cmp         r1, #1
  00008	1a00000b	 bne         |$LN6@DllEntry|

; 57   :         SD_DEBUG_ZONE_REGISTER(hInstance, NULL);
; 58   :         DisableThreadLibraryCalls((HMODULE) hInstance);

  0000c	eb000000	 bl          DisableThreadLibraryCalls

; 59   : 
; 60   :         if( !SDInitializeCardLib() )

  00010	eb000000	 bl          SDInitializeCardLib
  00014	e3500000	 cmp         r0, #0
  00018	1a000002	 bne         |$LN5@DllEntry|
  0001c		 |$LN9@DllEntry|

; 61   :         {
; 62   :             return FALSE;

  0001c	e3a00000	 mov         r0, #0

; 77   : }

  00020	e49de004	 ldr         lr, [sp], #4
  00024	e12fff1e	 bx          lr
  00028		 |$LN5@DllEntry|

; 63   :         }
; 64   :         else if( !SD_API_SUCCESS( SDHCDInitializeHCLib() ) )

  00028	eb000000	 bl          SDHCDInitializeHCLib
  0002c	e3500000	 cmp         r0, #0
  00030	5a000005	 bpl         |$LN1@DllEntry|

; 65   :         {
; 66   :             SDDeinitializeCardLib();

  00034	eb000000	 bl          SDDeinitializeCardLib

; 67   :             return FALSE;

  00038	eafffff7	 b           |$LN9@DllEntry|
  0003c		 |$LN6@DllEntry|

; 68   :         }
; 69   :     }
; 70   :     else if ( Reason == DLL_PROCESS_DETACH ) 

  0003c	e3510000	 cmp         r1, #0
  00040	1a000001	 bne         |$LN1@DllEntry|

; 71   :     {
; 72   :         SDHCDDeinitializeHCLib();

  00044	eb000000	 bl          SDHCDDeinitializeHCLib

; 73   :         SDDeinitializeCardLib();

  00048	eb000000	 bl          SDDeinitializeCardLib
  0004c		 |$LN1@DllEntry|

; 74   :     }
; 75   :     
; 76   :     return(TRUE);

  0004c	e3a00001	 mov         r0, #1

; 77   : }

  00050	e49de004	 ldr         lr, [sp], #4
  00054	e12fff1e	 bx          lr
  00058		 |$M40607|

			 ENDP  ; |DllEntry|

	EXPORT	|SHC_Deinit|
	IMPORT	|?FreeHostContext@CSDIOControllerBase@@QAAXHH@Z| ; CSDIOControllerBase::FreeHostContext

  00000			 AREA	 |.pdata|, PDATA
|$T40619| DCD	|$LN5@SHC_Deinit|
	DCD	0x40000701
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SHC_Deinit| PROC

; 135  : {    

  00000		 |$LN5@SHC_Deinit|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M40616|

; 136  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHC +Deinit\n")));
; 137  :     
; 138  :     CSDIOControllerBase *pController = (CSDIOControllerBase*) hDeviceContext;    
; 139  :     pController->FreeHostContext( TRUE, TRUE );

  00004	e3a02001	 mov         r2, #1
  00008	e3a01001	 mov         r1, #1
  0000c	eb000000	 bl          |?FreeHostContext@CSDIOControllerBase@@QAAXHH@Z|

; 140  :     
; 141  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHC -Deinit\n")));
; 142  :     
; 143  :     return TRUE;

  00010	e3a00001	 mov         r0, #1

; 144  : }

  00014	e49de004	 ldr         lr, [sp], #4
  00018	e12fff1e	 bx          lr
  0001c		 |$M40617|

			 ENDP  ; |SHC_Deinit|

	EXPORT	|SHC_Open|

  00000			 AREA	 |.pdata|, PDATA
|$T40629| DCD	|$LN5@SHC_Open|
	DCD	0x40000100
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SHC_Open| PROC

; 160  : {

  00000		 |$LN5@SHC_Open|
  00000		 |$M40626|

; 161  :     CSDIOControllerBase * pController = (CSDIOControllerBase*) hDeviceContext;
; 162  :     return (DWORD) pController;
; 163  : }

  00000	e12fff1e	 bx          lr
  00004		 |$M40627|

			 ENDP  ; |SHC_Open|

	EXPORT	|SHC_Close|

  00000			 AREA	 |.pdata|, PDATA
|$T40638| DCD	|$LN5@SHC_Close|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SHC_Close| PROC

; 177  : {

  00000		 |$LN5@SHC_Close|
  00000		 |$M40635|

; 178  :     CSDIOControllerBase * pController = (CSDIOControllerBase *) hOpenContext;
; 179  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 180  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40636|

			 ENDP  ; |SHC_Close|

	EXPORT	|SHC_IOControl|
	IMPORT	|?IOControl@CSDIOControllerBase@@QAAHKPAEK0KPAK@Z| ; CSDIOControllerBase::IOControl

  00000			 AREA	 |.pdata|, PDATA
|$T40652| DCD	|$LN7@SHC_IOCont|
	DCD	0x40000f02
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SHC_IOControl| PROC

; 200  : {

  00000		 |$LN7@SHC_IOCont|
  00000	e92d4070	 stmdb       sp!, {r4 - r6, lr}
  00004	e24dd00c	 sub         sp, sp, #0xC
  00008		 |$M40649|
  00008	e1b06000	 movs        r6, r0

; 201  :     BOOL rc = FALSE;
; 202  :     
; 203  :     CSDIOControllerBase * pController = (CSDIOControllerBase*) hOpenContext;
; 204  :     
; 205  :     // Check if we get correct context
; 206  :     if (pController == NULL)
; 207  :     {
; 208  :         DEBUGMSG(SDCARD_ZONE_ERROR, (L"ERROR: SHC_IOControl: "
; 209  :             L"Incorrect context paramer\r\n" ));
; 210  :         goto clean;
; 211  :     }
; 212  : 
; 213  :     
; 214  :     rc = pController->IOControl(dwCode, pBufIn, dwLenIn, pBufOut, dwLenOut, pdwActualOut);

  0000c	159de024	 ldrne       lr, [sp, #0x24]
  00010	159d4020	 ldrne       r4, [sp, #0x20]
  00014	159d501c	 ldrne       r5, [sp, #0x1C]
  00018	e3a00000	 mov         r0, #0
  0001c	11a00006	 movne       r0, r6
  00020	158de008	 strne       lr, [sp, #8]
  00024	158d4004	 strne       r4, [sp, #4]
  00028	158d5000	 strne       r5, [sp]
  0002c	1b000000	 blne        |?IOControl@CSDIOControllerBase@@QAAHKPAEK0KPAK@Z|
  00030		 |$clean$39910|

; 215  :     
; 216  : clean:
; 217  :     return rc;
; 218  : }

  00030	e28dd00c	 add         sp, sp, #0xC
  00034	e8bd4070	 ldmia       sp!, {r4 - r6, lr}
  00038	e12fff1e	 bx          lr
  0003c		 |$M40650|

			 ENDP  ; |SHC_IOControl|

	EXPORT	|SHC_Init|
	IMPORT	|?Init@CSDIOControllerBase@@QAAHPBG@Z|	; CSDIOControllerBase::Init
	IMPORT	|?CreateSDIOController@@YAPAVCSDIOControllerBase@@XZ| ; CreateSDIOController

  00000			 AREA	 |.pdata|, PDATA
|$T40669| DCD	|$LN13@SHC_Init|
	DCD	0x40001201
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SHC_Init| PROC

; 95   : {

  00000		 |$LN13@SHC_Init|
  00000	e92d4070	 stmdb       sp!, {r4 - r6, lr}
  00004		 |$M40666|
  00004	e1a06000	 mov         r6, r0

; 96   :     LPCTSTR pszActiveKey = (LPCTSTR) dwContext;
; 97   :     DWORD   dwRet = 0;

  00008	e3a04000	 mov         r4, #0

; 98   : 
; 99   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHC +Init\n")));    
; 100  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHC Active RegPath: %s \n"), pszActiveKey));
; 101  : 
; 102  :     PCSDIOControllerBase pController = CreateSDIOController();

  0000c	eb000000	 bl          |?CreateSDIOController@@YAPAVCSDIOControllerBase@@XZ|
  00010	e1b05000	 movs        r5, r0

; 103  :     if (!pController) {

  00014	0a000008	 beq         |$LN8@SHC_Init|

; 104  :         DEBUGMSG(SDCARD_ZONE_ERROR, (TEXT("SDHC Failed to create controller object\n")));
; 105  :         goto EXIT;
; 106  :     }
; 107  : 
; 108  :     if (!pController->Init(pszActiveKey)) {

  00018	e1a01006	 mov         r1, r6
  0001c	e1a00005	 mov         r0, r5
  00020	eb000000	 bl          |?Init@CSDIOControllerBase@@QAAHPBG@Z|
  00024	e3500000	 cmp         r0, #0

; 109  :         goto EXIT;
; 110  :     }
; 111  : 
; 112  :     // Return the controller instance
; 113  :     dwRet = (DWORD) pController;
; 114  : 
; 115  : EXIT:
; 116  :     if ( (dwRet == 0) && pController ) {
; 117  :         SHC_Deinit((DWORD) pController);

  00028	03a02001	 moveq       r2, #1
  0002c	03a01001	 moveq       r1, #1
  00030	01a00005	 moveq       r0, r5
  00034	11a04005	 movne       r4, r5
  00038		 |$EXIT$39868|
  00038	0b000000	 bleq        |?FreeHostContext@CSDIOControllerBase@@QAAXHH@Z|
  0003c		 |$LN8@SHC_Init|

; 118  :     }
; 119  : 
; 120  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHC -Init\n")));
; 121  : 
; 122  :     return dwRet;
; 123  : }

  0003c	e1a00004	 mov         r0, r4
  00040	e8bd4070	 ldmia       sp!, {r4 - r6, lr}
  00044	e12fff1e	 bx          lr
  00048		 |$M40667|

			 ENDP  ; |SHC_Init|

	END
