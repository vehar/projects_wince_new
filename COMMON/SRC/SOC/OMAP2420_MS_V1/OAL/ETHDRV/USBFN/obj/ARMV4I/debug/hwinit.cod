; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\COMMON\SRC\SOC\OMAP2420_MS_V1\OAL\ETHDRV\USBFN\hwinit.c
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "


  00000			 AREA	 |.rdata|, DATA, READONLY
|EdbgVendorIds| DCW 0x0
	DCW	0x0
	DCD	0x4033
	DCB	0x1
	DCB	"AD", 0x0
	DCW	0x1050
	DCW	0x940
	DCD	0x4005
	DCB	0x1
	DCB	"LS", 0x0
	DCW	0x1050
	DCW	0x940
	DCD	0x2078
	DCB	0x1
	DCB	"LS", 0x0
	DCW	0x10ec
	DCW	0x8029
	DCD	0xc0f0
	DCB	0x1
	DCB	"KS", 0x0
	DCW	0x10ec
	DCW	0x8129
	DCD	0x0
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0x900b
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0xd0c9
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0xe04c
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x1186
	DCW	0x1300
	DCD	0x50ba
	DCB	0x4
	DCB	"DL", 0x0
	DCW	0x100b
	DCW	0x20
	DCD	0xa0cc
	DCB	0x5
	DCB	"NG", 0x0
	DCW	0x10b7
	DCW	0x9050
	DCD	0x6008
	DCB	0x6
	DCB	"3C", 0x0
	DCW	0x10b7
	DCW	0x9200
	DCD	0x476
	DCB	0x6
	DCB	"3C", 0x0
	EXPORT	|InitSystemControl|

  00000			 AREA	 |.pdata|, PDATA
|$T45500| DCD	|$LN5@InitSystem|
	DCD	0x40000601
; Function compile flags: /Odtp
; File c:\wince600\platform\common\src\soc\omap2420_ms_v1\oal\ethdrv\usbfn\hwinit.c

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |InitSystemControl| PROC

; 38   : {

  00000		 |$LN5@InitSystem|
  00000	e24dd004	 sub         sp, sp, #4
  00004		 |$M45497|

; 39   : #if 0
; 40   :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"+USBFN:: Initialize System Control\r\n"));
; 41   :     {
; 42   :         DWORD temp, mode;
; 43   :         OMAP2420_SYSC1_REGS *pSysConRegs = OALPAtoUA(OMAP2420_SYSC1_REGS_PA);
; 44   :     
; 45   :         temp = INREG32(&pSysConRegs->ulCONTROL_DEVCONF);
; 46   : 
; 47   :         mode = USBX_TRX_MODE;
; 48   : 
; 49   :         // Clear USBT0WRIMODEI. This places the USB Controls in Unidirectional Mode
; 50   :         temp &= 0xFF3FFFFF;
; 51   : 
; 52   :         // Set the Transceiver Interface Mode for USB Port 0
; 53   :         if ((mode == 0x01) || (mode == 0x02))
; 54   :         {
; 55   :             // Change the mode to Bidirectional.
; 56   :             temp |= 0x00800000;
; 57   :         }
; 58   : 
; 59   :         // Make sure the USB Enable signal is being used as an Active-High signal
; 60   :         temp &= 0xFFFEFFFF;
; 61   : 
; 62   :         // Make sure the USB module standby signal is not asserted
; 63   :         temp &= 0xFFFF7FFF;
; 64   : 
; 65   :         OUTREG32(&pSysConRegs->ulCONTROL_DEVCONF, temp);
; 66   :     
; 67   :     }
; 68   :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"-USBFN:: Initialize System Control\r\n"));
; 69   : #endif
; 70   :     return TRUE;

  00004	e3a03001	 mov         r3, #1
  00008	e58d3000	 str         r3, [sp]

; 71   : }

  0000c	e59d0000	 ldr         r0, [sp]
  00010	e28dd004	 add         sp, sp, #4
  00014	e12fff1e	 bx          lr
  00018		 |$M45498|

			 ENDP  ; |InitSystemControl|

	EXPORT	|??_C@_1EK@LOAOAFDM@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@| [ DATA ] ; `string'
	EXPORT	|??_C@_1EK@IADNEICF@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@| [ DATA ] ; `string'
	EXPORT	|InitOTGController|
	IMPORT	|OALPAtoVA|
	IMPORT	|NKDbgPrintfW|
	IMPORT	|dpCurSettings|

  00008			 AREA	 |.pdata|, PDATA
|$T45510| DCD	|$LN11@InitOTGCon|
	DCD	0x40004e02

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EK@LOAOAFDM@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@| DCB "-"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "O", 0x0, "T", 0x0, "G", 0x0, " ", 0x0, "C"
	DCB	0x0, "o", 0x0, "n", 0x0, "t", 0x0, "r", 0x0, "o", 0x0, "l"
	DCB	0x0, "l", 0x0, "e", 0x0, "r", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EK@IADNEICF@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@| DCB "+"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "O", 0x0, "T", 0x0, "G", 0x0, " ", 0x0, "C"
	DCB	0x0, "o", 0x0, "n", 0x0, "t", 0x0, "r", 0x0, "o", 0x0, "l"
	DCB	0x0, "l", 0x0, "e", 0x0, "r", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'
; Function compile flags: /Odtp

  00018			 AREA	 |.text|, CODE, ARM

  00018		 |InitOTGController| PROC

; 76   : {

  00018		 |$LN11@InitOTGCon|
  00018	e52de004	 str         lr, [sp, #-4]!
  0001c	e24dd018	 sub         sp, sp, #0x18
  00020		 |$M45507|

; 77   :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"+USBFN:: Initialize OTG Controller\r\n"));

  00020	e59f3118	 ldr         r3, [pc, #0x118]
  00024	e5933440	 ldr         r3, [r3, #0x440]
  00028	e3130a02	 tst         r3, #2, 20
  0002c	0a000008	 beq         |$LN5@InitOTGCon|
  00030	e59f3108	 ldr         r3, [pc, #0x108]
  00034	e5933440	 ldr         r3, [r3, #0x440]
  00038	e3130004	 tst         r3, #4
  0003c	0a000004	 beq         |$LN5@InitOTGCon|
  00040	e59f0104	 ldr         r0, [pc, #0x104]
  00044	eb000000	 bl          NKDbgPrintfW
  00048	e3a03001	 mov         r3, #1
  0004c	e58d300c	 str         r3, [sp, #0xC]
  00050	ea000001	 b           |$LN6@InitOTGCon|
  00054		 |$LN5@InitOTGCon|
  00054	e3a03000	 mov         r3, #0
  00058	e58d300c	 str         r3, [sp, #0xC]
  0005c		 |$LN6@InitOTGCon|

; 78   :     {
; 79   :         DWORD temp;
; 80   :         OMAP2420_OTG_REGS *pOTGRegs = OALPAtoUA(OMAP2420_OTG_REGS_PA);

  0005c	e3a01000	 mov         r1, #0
  00060	e59f00e0	 ldr         r0, [pc, #0xE0]
  00064	eb000000	 bl          OALPAtoVA
  00068	e58d0010	 str         r0, [sp, #0x10]
  0006c	e59d3010	 ldr         r3, [sp, #0x10]
  00070	e58d3004	 str         r3, [sp, #4]

; 81   :     
; 82   :         // Reset all USB controllers
; 83   :         OUTREG32(&pOTGRegs->SYSCON_1, OTG_SYSCON_1_SOFT_RESET);    

  00074	e59d3004	 ldr         r3, [sp, #4]
  00078	e2832004	 add         r2, r3, #4
  0007c	e3a03002	 mov         r3, #2
  00080	e5823000	 str         r3, [r2]
  00084		 |$LN2@InitOTGCon|

; 84   :         
; 85   :         // Wait for the reset to complete.
; 86   :         while ((INREG32(&pOTGRegs->SYSCON_1) & OTG_SYSCON_1_RESET_DONE) == 0);

  00084	e59d3004	 ldr         r3, [sp, #4]
  00088	e2833004	 add         r3, r3, #4
  0008c	e5933000	 ldr         r3, [r3]
  00090	e3130004	 tst         r3, #4
  00094	1a000000	 bne         |$LN1@InitOTGCon|
  00098	eafffff9	 b           |$LN2@InitOTGCon|
  0009c		 |$LN1@InitOTGCon|

; 87   :         
; 88   :         // Set USBx_TRX_MODE
; 89   :         // Note that the H4 System's two USB transceivers will only work in
; 90   :         // one of the three available transceiver modes. The USB OTG transceiver
; 91   :         // (ISP1301BS) will only work in the 3-pin bidirectional mode. The USB
; 92   :         // Device Transceiver will only work in the 6-pin unidirectional mode.
; 93   :         temp= (USBX_TRX_MODE << 24) | (USBX_TRX_MODE << 20) | (USBX_TRX_MODE << 16); 

  0009c	e3a03633	 mov         r3, #0x33, 12
  000a0	e3833803	 orr         r3, r3, #3, 16
  000a4	e58d3000	 str         r3, [sp]

; 94   :         OUTREG32(&pOTGRegs->SYSCON_1, temp);

  000a8	e59d3004	 ldr         r3, [sp, #4]
  000ac	e2832004	 add         r2, r3, #4
  000b0	e59d3000	 ldr         r3, [sp]
  000b4	e5823000	 str         r3, [r2]

; 95   :         {
; 96   :             temp = INREG32(&pOTGRegs->SYSCON_2);

  000b8	e59d3004	 ldr         r3, [sp, #4]
  000bc	e2833008	 add         r3, r3, #8
  000c0	e5933000	 ldr         r3, [r3]
  000c4	e58d3000	 str         r3, [sp]

; 97   :             OUTREG32(&pOTGRegs->SYSCON_2, 0x5B240080);      // USB_DET is not connect correctly, so try OTG for BSESSVLD

  000c8	e59d3004	 ldr         r3, [sp, #4]
  000cc	e2832008	 add         r2, r3, #8
  000d0	e59f306c	 ldr         r3, [pc, #0x6C]
  000d4	e5823000	 str         r3, [r2]

; 98   :         
; 99   :             // We don't get any interrupts from the USB Device unless this bit
; 100  :             // is set. Unfortunately, setting this bit also sets the "USB
; 101  :             // Cable Attached" bit, which remains set regardless of whether or
; 102  :             // not a cable is actually attached, and thus prevents us from
; 103  :             // being able to properly tell when a USB cable is connected to or
; 104  :             // disconnected from the device.
; 105  :             // The OMAP2420 TRM suggest having an additional hardware mechanism
; 106  :             // that would allow the driver to detect when a cable is connected
; 107  :             // and then set the BSESSVLD bit as appropriate. The H4 System
; 108  :             // design lacks this feature, so we'll have to use a workaround in
; 109  :             // the USB Driver PDD to compensate for this.        
; 110  :             OUTREG32(&pOTGRegs->CTRL, OTG_CTRL_BSESSVLD);

  000d8	e59d3004	 ldr         r3, [sp, #4]
  000dc	e283200c	 add         r2, r3, #0xC
  000e0	e3a03701	 mov         r3, #1, 14
  000e4	e5823000	 str         r3, [r2]

; 111  :         }   
; 112  :     }
; 113  :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"-USBFN:: Initialize OTG Controller\r\n"));

  000e8	e59f3050	 ldr         r3, [pc, #0x50]
  000ec	e5933440	 ldr         r3, [r3, #0x440]
  000f0	e3130a02	 tst         r3, #2, 20
  000f4	0a000008	 beq         |$LN7@InitOTGCon|
  000f8	e59f3040	 ldr         r3, [pc, #0x40]
  000fc	e5933440	 ldr         r3, [r3, #0x440]
  00100	e3130004	 tst         r3, #4
  00104	0a000004	 beq         |$LN7@InitOTGCon|
  00108	e59f002c	 ldr         r0, [pc, #0x2C]
  0010c	eb000000	 bl          NKDbgPrintfW
  00110	e3a03001	 mov         r3, #1
  00114	e58d3014	 str         r3, [sp, #0x14]
  00118	ea000001	 b           |$LN8@InitOTGCon|
  0011c		 |$LN7@InitOTGCon|
  0011c	e3a03000	 mov         r3, #0
  00120	e58d3014	 str         r3, [sp, #0x14]
  00124		 |$LN8@InitOTGCon|

; 114  :     return TRUE;

  00124	e3a03001	 mov         r3, #1
  00128	e58d3008	 str         r3, [sp, #8]

; 115  : }

  0012c	e59d0008	 ldr         r0, [sp, #8]
  00130	e28dd018	 add         sp, sp, #0x18
  00134	e49de004	 ldr         lr, [sp], #4
  00138	e12fff1e	 bx          lr
  0013c		 |$LN12@InitOTGCon|
  0013c		 |$LN13@InitOTGCon|
  0013c	00000000	 DCD         |??_C@_1EK@LOAOAFDM@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@|
  00140		 |$LN14@InitOTGCon|
  00140	00000000	 DCD         |dpCurSettings|
  00144		 |$LN15@InitOTGCon|
  00144	5b240080	 DCD         0x5b240080
  00148		 |$LN16@InitOTGCon|
  00148	4805e300	 DCD         0x4805e300
  0014c		 |$LN17@InitOTGCon|
  0014c	00000000	 DCD         |??_C@_1EK@IADNEICF@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAO?$AAT?$AAG?$AA?5?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AAl@|
  00150		 |$M45508|

			 ENDP  ; |InitOTGController|

	EXPORT	|??_C@_1EI@EOBGBOHG@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@| [ DATA ] ; `string'
	EXPORT	|??_C@_1EI@BMMPPLIM@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@| [ DATA ] ; `string'
	EXPORT	|InitClockController|

  00010			 AREA	 |.pdata|, PDATA
|$T45526| DCD	|$LN9@InitClockC|
	DCD	0x40003f02

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EI@EOBGBOHG@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@| DCB "-"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "U", 0x0, "S", 0x0, "B", 0x0, " ", 0x0, "C"
	DCB	0x0, "l", 0x0, "o", 0x0, "c", 0x0, "k", 0x0, " ", 0x0, "M"
	DCB	0x0, "g", 0x0, "r", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EI@BMMPPLIM@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@| DCB "+"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "U", 0x0, "S", 0x0, "B", 0x0, " ", 0x0, "C"
	DCB	0x0, "l", 0x0, "o", 0x0, "c", 0x0, "k", 0x0, " ", 0x0, "M"
	DCB	0x0, "g", 0x0, "r", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Odtp

  00150			 AREA	 |.text|, CODE, ARM

  00150		 |InitClockController| PROC

; 120  : {

  00150		 |$LN9@InitClockC|
  00150	e52de004	 str         lr, [sp, #-4]!
  00154	e24dd014	 sub         sp, sp, #0x14
  00158		 |$M45523|

; 121  :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"+USBFN:: Initialize USB Clock Mgr\r\n"));

  00158	e59f30e4	 ldr         r3, [pc, #0xE4]
  0015c	e5933440	 ldr         r3, [r3, #0x440]
  00160	e3130a02	 tst         r3, #2, 20
  00164	0a000008	 beq         |$LN3@InitClockC|
  00168	e59f30d4	 ldr         r3, [pc, #0xD4]
  0016c	e5933440	 ldr         r3, [r3, #0x440]
  00170	e3130004	 tst         r3, #4
  00174	0a000004	 beq         |$LN3@InitClockC|
  00178	e59f00c8	 ldr         r0, [pc, #0xC8]
  0017c	eb000000	 bl          NKDbgPrintfW
  00180	e3a03001	 mov         r3, #1
  00184	e58d3008	 str         r3, [sp, #8]
  00188	ea000001	 b           |$LN4@InitClockC|
  0018c		 |$LN3@InitClockC|
  0018c	e3a03000	 mov         r3, #0
  00190	e58d3008	 str         r3, [sp, #8]
  00194		 |$LN4@InitClockC|

; 122  :     {
; 123  :         OMAP2420_PRCM_REGS * pPRCMRegs = OALPAtoUA(OMAP2420_PRCM_REGS_PA);

  00194	e3a01000	 mov         r1, #0
  00198	e3a00312	 mov         r0, #0x12, 6
  0019c	e3800902	 orr         r0, r0, #2, 18
  001a0	eb000000	 bl          OALPAtoVA
  001a4	e58d000c	 str         r0, [sp, #0xC]
  001a8	e59d300c	 ldr         r3, [sp, #0xC]
  001ac	e58d3000	 str         r3, [sp]

; 124  :         
; 125  : #if 0
; 126  :         // Disable the USB Interface clock
; 127  :         CLRREG32(&pPRCMRegs->ulCM_ICLKEN2_CORE,   0x00000001);    // Clear EN_USB
; 128  : #endif    
; 129  :         // Configure the USB Interface Clock Speed
; 130  :         CLRREG32(&pPRCMRegs->ulCM_CLKSEL1_CORE,   0x0E000000);    // Clear clk = L3_CLK/1 (boot mode only)

  001b0	e59d3000	 ldr         r3, [sp]
  001b4	e2833d09	 add         r3, r3, #9, 26
  001b8	e5932000	 ldr         r2, [r3]
  001bc	e3e0340e	 mvn         r3, #0xE, 8
  001c0	e0022003	 and         r2, r2, r3
  001c4	e59d3000	 ldr         r3, [sp]
  001c8	e2833d09	 add         r3, r3, #9, 26
  001cc	e5832000	 str         r2, [r3]

; 131  :         SETREG32(&pPRCMRegs->ulCM_CLKSEL1_CORE,   0x08000000);    // Set   clk = L3_CLK/3

  001d0	e59d3000	 ldr         r3, [sp]
  001d4	e2833d09	 add         r3, r3, #9, 26
  001d8	e5933000	 ldr         r3, [r3]
  001dc	e3832302	 orr         r2, r3, #2, 6
  001e0	e59d3000	 ldr         r3, [sp]
  001e4	e2833d09	 add         r3, r3, #9, 26
  001e8	e5832000	 str         r2, [r3]

; 132  :     
; 133  : #if 0    
; 134  :         // Ensure that the USB Interface clock remains active when the MPU enters Idle Mode.
; 135  :         CLRREG32(&pPRCMRegs->ulCM_AUTOIDLE2_CORE, 0x00000001);    // Clear AUTO_USB
; 136  :     
; 137  :         // Enable the USB Interface clock
; 138  :         SETREG32(&pPRCMRegs->ulCM_ICLKEN2_CORE,   0x00000001);    // Set   EN_USB
; 139  :     
; 140  :         // Enable the USB Functional clock
; 141  :         SETREG32(&pPRCMRegs->ulCM_FCLKEN2_CORE,   0x00000001);    // Set   EN_USB
; 142  :     
; 143  :         // Enable USB Wake-Up
; 144  :         SETREG32(&pPRCMRegs->ulPM_WKEN2_CORE,     0x00000001);    // Set   EN_USB
; 145  : #endif        
; 146  :     }
; 147  :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"-USBFN:: Initialize USB Clock Mgr\r\n"));

  001ec	e59f3050	 ldr         r3, [pc, #0x50]
  001f0	e5933440	 ldr         r3, [r3, #0x440]
  001f4	e3130a02	 tst         r3, #2, 20
  001f8	0a000008	 beq         |$LN5@InitClockC|
  001fc	e59f3040	 ldr         r3, [pc, #0x40]
  00200	e5933440	 ldr         r3, [r3, #0x440]
  00204	e3130004	 tst         r3, #4
  00208	0a000004	 beq         |$LN5@InitClockC|
  0020c	e59f002c	 ldr         r0, [pc, #0x2C]
  00210	eb000000	 bl          NKDbgPrintfW
  00214	e3a03001	 mov         r3, #1
  00218	e58d3010	 str         r3, [sp, #0x10]
  0021c	ea000001	 b           |$LN6@InitClockC|
  00220		 |$LN5@InitClockC|
  00220	e3a03000	 mov         r3, #0
  00224	e58d3010	 str         r3, [sp, #0x10]
  00228		 |$LN6@InitClockC|

; 148  :     return TRUE;

  00228	e3a03001	 mov         r3, #1
  0022c	e58d3004	 str         r3, [sp, #4]

; 149  : }

  00230	e59d0004	 ldr         r0, [sp, #4]
  00234	e28dd014	 add         sp, sp, #0x14
  00238	e49de004	 ldr         lr, [sp], #4
  0023c	e12fff1e	 bx          lr
  00240		 |$LN10@InitClockC|
  00240		 |$LN11@InitClockC|
  00240	00000000	 DCD         |??_C@_1EI@EOBGBOHG@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@|
  00244		 |$LN12@InitClockC|
  00244	00000000	 DCD         |dpCurSettings|
  00248		 |$LN13@InitClockC|
  00248	00000000	 DCD         |??_C@_1EI@BMMPPLIM@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAU?$AAS?$AAB?$AA?5?$AAC?$AAl?$AAo?$AAc?$AAk?$AA?5?$AAM?$AAg@|
  0024c		 |$M45524|

			 ENDP  ; |InitClockController|

	EXPORT	|??_C@_1DO@GLBGAPLB@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DO@GJKMECBD@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|InitializeHardware|

  00018			 AREA	 |.pdata|, PDATA
|$T45540| DCD	|$LN9@Initialize|
	DCD	0x40002c02

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DO@GLBGAPLB@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@| DCB "-"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "H", 0x0, "a", 0x0, "r", 0x0, "d", 0x0, "w"
	DCB	0x0, "a", 0x0, "r", 0x0, "e", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DO@GJKMECBD@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@| DCB "+"
	DCB	0x0, "U", 0x0, "S", 0x0, "B", 0x0, "F", 0x0, "N", 0x0, ":"
	DCB	0x0, ":", 0x0, " ", 0x0, "I", 0x0, "n", 0x0, "i", 0x0, "t"
	DCB	0x0, "i", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "z", 0x0, "e"
	DCB	0x0, " ", 0x0, "H", 0x0, "a", 0x0, "r", 0x0, "d", 0x0, "w"
	DCB	0x0, "a", 0x0, "r", 0x0, "e", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'
; Function compile flags: /Odtp

  0024c			 AREA	 |.text|, CODE, ARM

  0024c		 |InitializeHardware| PROC

; 154  : {

  0024c		 |$LN9@Initialize|
  0024c	e52de004	 str         lr, [sp, #-4]!
  00250	e24dd00c	 sub         sp, sp, #0xC
  00254		 |$M45537|

; 155  :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"+USBFN:: Initialize Hardware\r\n"));

  00254	e59f3098	 ldr         r3, [pc, #0x98]
  00258	e5933440	 ldr         r3, [r3, #0x440]
  0025c	e3130a02	 tst         r3, #2, 20
  00260	0a000008	 beq         |$LN3@Initialize|
  00264	e59f3088	 ldr         r3, [pc, #0x88]
  00268	e5933440	 ldr         r3, [r3, #0x440]
  0026c	e3130004	 tst         r3, #4
  00270	0a000004	 beq         |$LN3@Initialize|
  00274	e59f007c	 ldr         r0, [pc, #0x7C]
  00278	eb000000	 bl          NKDbgPrintfW
  0027c	e3a03001	 mov         r3, #1
  00280	e58d3004	 str         r3, [sp, #4]
  00284	ea000001	 b           |$LN4@Initialize|
  00288		 |$LN3@Initialize|
  00288	e3a03000	 mov         r3, #0
  0028c	e58d3004	 str         r3, [sp, #4]
  00290		 |$LN4@Initialize|

; 156  :     // Configure clock controller
; 157  :     InitClockController();

  00290	eb000000	 bl          InitClockController

; 158  :     // Configure OTG controller
; 159  :     InitOTGController();

  00294	eb000000	 bl          InitOTGController

; 160  :     // Configure System
; 161  :     InitSystemControl();

  00298	eb000000	 bl          InitSystemControl

; 162  :     // Done
; 163  :     OALMSG(OAL_ETHER&&OAL_FUNC, (L"-USBFN:: Initialize Hardware\r\n"));

  0029c	e59f3050	 ldr         r3, [pc, #0x50]
  002a0	e5933440	 ldr         r3, [r3, #0x440]
  002a4	e3130a02	 tst         r3, #2, 20
  002a8	0a000008	 beq         |$LN5@Initialize|
  002ac	e59f3040	 ldr         r3, [pc, #0x40]
  002b0	e5933440	 ldr         r3, [r3, #0x440]
  002b4	e3130004	 tst         r3, #4
  002b8	0a000004	 beq         |$LN5@Initialize|
  002bc	e59f002c	 ldr         r0, [pc, #0x2C]
  002c0	eb000000	 bl          NKDbgPrintfW
  002c4	e3a03001	 mov         r3, #1
  002c8	e58d3008	 str         r3, [sp, #8]
  002cc	ea000001	 b           |$LN6@Initialize|
  002d0		 |$LN5@Initialize|
  002d0	e3a03000	 mov         r3, #0
  002d4	e58d3008	 str         r3, [sp, #8]
  002d8		 |$LN6@Initialize|

; 164  :     return TRUE;

  002d8	e3a03001	 mov         r3, #1
  002dc	e58d3000	 str         r3, [sp]

; 165  : }

  002e0	e59d0000	 ldr         r0, [sp]
  002e4	e28dd00c	 add         sp, sp, #0xC
  002e8	e49de004	 ldr         lr, [sp], #4
  002ec	e12fff1e	 bx          lr
  002f0		 |$LN10@Initialize|
  002f0		 |$LN11@Initialize|
  002f0	00000000	 DCD         |??_C@_1DO@GLBGAPLB@?$AA?9?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@|
  002f4		 |$LN12@Initialize|
  002f4	00000000	 DCD         |dpCurSettings|
  002f8		 |$LN13@Initialize|
  002f8	00000000	 DCD         |??_C@_1DO@GJKMECBD@?$AA?$CL?$AAU?$AAS?$AAB?$AAF?$AAN?$AA?3?$AA?3?$AA?5?$AAI?$AAn?$AAi?$AAt?$AAi?$AAa?$AAl?$AAi?$AAz?$AAe?$AA?5?$AAH?$AAa?$AAr?$AAd?$AAw?$AAa?$AAr?$AAe?$AA?$AN?$AA?6?$AA?$AA@|
  002fc		 |$M45538|

			 ENDP  ; |InitializeHardware|

	EXPORT	|GetUniqueDeviceID|

  00020			 AREA	 |.pdata|, PDATA
|$T45550| DCD	|$LN5@GetUniqueD|
	DCD	0x40000701
; Function compile flags: /Odtp

  002fc			 AREA	 |.text|, CODE, ARM

  002fc		 |GetUniqueDeviceID| PROC

; 170  : {

  002fc		 |$LN5@GetUniqueD|
  002fc	e24dd004	 sub         sp, sp, #4
  00300		 |$M45547|

; 171  :     /* TODO : need to find unique silicon id
; 172  :     DWORD dwID0 = 0;
; 173  : 
; 174  :     OMAP2420_DEVICE_ID_REGS *pDeviceIDRegs = OALPAtoUA(OMAP2420_DEVICE_ID_REGS_PA);
; 175  : 
; 176  :     dwID0 = INREG32(&pDeviceIDRegs->OMAP_DIE_ID_0);
; 177  :     dwID1 = INREG32(&pDeviceIDRegs->OMAP_DIE_ID_1);
; 178  :     
; 179  :     return dwID0 ^ dwID1;
; 180  :     */
; 181  :     
; 182  :     return 0x0B5D902F;  // hardcoded id

  00300	e59f300c	 ldr         r3, [pc, #0xC]
  00304	e58d3000	 str         r3, [sp]

; 183  : }

  00308	e59d0000	 ldr         r0, [sp]
  0030c	e28dd004	 add         sp, sp, #4
  00310	e12fff1e	 bx          lr
  00314		 |$LN6@GetUniqueD|
  00314		 |$LN7@GetUniqueD|
  00314	0b5d902f	 DCD         0xb5d902f
  00318		 |$M45548|

			 ENDP  ; |GetUniqueDeviceID|

	END
